<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <link href="./tailwind.css" rel="stylesheet">
</head>
<body class="bg-gray-50 m-0 font-sans">
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    
    <script type="text/babel">
        function ChatInput({ chatMessages, setChatMessages }) {
            const [inputText, setInputText] = React.useState('');

            function saveInputText(event) {
                setInputText(event.target.value);
            }
            
            function sendMessage() {
                const newChatMessages = [
                    ...chatMessages,
                    {
                        message: inputText,
                        sender: 'user',
                        id: crypto.randomUUID()
                    }
                ];

                setChatMessages(newChatMessages);

                const response = Chatbot.getResponse(inputText);
                setChatMessages([
                    ...newChatMessages,
                    {
                        message: response,
                        sender: 'robot',
                        id: crypto.randomUUID()
                    }
                ]);

                setInputText('');
            }

            return (
                <div className="flex mb-16 gap-3">
                    <input
                        placeholder="Send a message to Chatbot"
                        size="30"
                        onChange={saveInputText}
                        value={inputText}
                        className="px-4 py-3 rounded-lg border border-gray-300 text-base flex-grow bg-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    />
                    <button
                        onClick={sendMessage}
                        className="bg-green-600 hover:bg-green-700 text-white px-5 py-3 border-none rounded-lg text-base cursor-pointer transition-colors duration-200 whitespace-nowrap"
                    >
                        Send
                    </button>
                </div>
            );
        }

        function ChatMessage({ message, sender }) {
            return (
                <div className={
                    sender === 'user'
                        ? 'flex justify-end items-start mb-4'
                        : 'flex items-start mb-4'
                }>
                    {sender === 'robot' && (
                        <img src="./robot.png" className="w-6 h-6 rounded-full" alt="Robot" />
                    )}
                    <div className="bg-gray-200 px-5 py-4 rounded-lg mr-3 ml-3 max-w-xs break-words">
                        {message}
                    </div>
                    {sender === 'user' && (
                        <img src="./user.png" className="w-6 h-6 rounded-full" alt="User" />
                    )}
                </div>
            );
        }

        function ChatMessages({ chatMessages }) {
            const chatMessagesRef = React.useRef(null);

            React.useEffect(() => {
                const containerElem = chatMessagesRef.current;
                if (containerElem) {
                    containerElem.scrollTop = containerElem.scrollHeight;
                }
            }, [chatMessages]);

            return (
                <div className="flex-grow mt-5 overflow-auto p-2" ref={chatMessagesRef}>
                    {chatMessages.map((chatMessage) => {
                        return (
                            <ChatMessage
                                message={chatMessage.message}
                                sender={chatMessage.sender}
                                key={chatMessage.id}
                            />
                        );
                    })}
                </div>
            );
        }

        function App() {
            const [chatMessages, setChatMessages] = React.useState([
                {
                    message: 'hello chatbot',
                    sender: 'user',
                    id: 'id1'
                },
                {
                    message: 'Hello! How can I help you?',
                    sender: 'robot',
                    id: 'id2'
                },
                {
                    message: 'can you get me todays date?',
                    sender: 'user',
                    id: 'id3'
                },
                {
                    message: 'Sure! Today is 1st September. Anything else you need??',
                    sender: 'robot',
                    id: 'id4'
                }
            ]);

            return (
                <div className="max-w-2xl mx-auto h-screen flex flex-col bg-gray-50 p-4">
                    <ChatMessages chatMessages={chatMessages} />
                    <ChatInput
                        chatMessages={chatMessages}
                        setChatMessages={setChatMessages}
                    />
                </div>
            );
        }

        const container = document.querySelector('.js-container');
        ReactDOM.createRoot(container).render(<App />);
    </script>
</body>
</html>